{"ast":null,"code":"// src/api.js\nimport axios from \"axios\";\nconst api = axios.create({\n  baseURL: process.env.REACT_APP_API_BASE || \"http://localhost:5000/api\"\n});\n\n// thêm token vào request\napi.interceptors.request.use(config => {\n  const s = localStorage.getItem(\"authUser\");\n  if (s) {\n    try {\n      const {\n        token\n      } = JSON.parse(s);\n      if (token) config.headers.Authorization = `Bearer ${token}`;\n    } catch {}\n  }\n  return config;\n});\n\n// tự refresh token khi 401\napi.interceptors.response.use(res => res, async error => {\n  var _error$response;\n  const original = error.config;\n\n  // nếu token hết hạn\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !original._retry) {\n    original._retry = true;\n    const saved = localStorage.getItem(\"authUser\");\n    if (!saved) return Promise.reject(error);\n    const {\n      refreshToken\n    } = JSON.parse(saved);\n    try {\n      const res = await axios.post(\"http://localhost:5000/api/auth/refresh\", {\n        refreshToken\n      });\n      const pack = {\n        token: res.data.token,\n        refreshToken: res.data.refreshToken,\n        user: JSON.parse(saved).user\n      };\n      localStorage.setItem(\"authUser\", JSON.stringify(pack));\n      api.defaults.headers.Authorization = `Bearer ${res.data.token}`;\n      original.headers.Authorization = `Bearer ${res.data.token}`;\n      return api(original);\n    } catch (err) {\n      localStorage.removeItem(\"authUser\");\n      window.location.href = \"/\";\n    }\n  }\n  return Promise.reject(error);\n});\nexport default api;","map":{"version":3,"names":["axios","api","create","baseURL","process","env","REACT_APP_API_BASE","interceptors","request","use","config","s","localStorage","getItem","token","JSON","parse","headers","Authorization","response","res","error","_error$response","original","status","_retry","saved","Promise","reject","refreshToken","post","pack","data","user","setItem","stringify","defaults","err","removeItem","window","location","href"],"sources":["C:/HRM_Project/frontend/src/api.js"],"sourcesContent":["// src/api.js\r\nimport axios from \"axios\";\r\n\r\nconst api = axios.create({\r\n  baseURL: process.env.REACT_APP_API_BASE || \"http://localhost:5000/api\",\r\n});\r\n\r\n// thêm token vào request\r\napi.interceptors.request.use((config) => {\r\n  const s = localStorage.getItem(\"authUser\");\r\n  if (s) {\r\n    try {\r\n      const { token } = JSON.parse(s);\r\n      if (token) config.headers.Authorization = `Bearer ${token}`;\r\n    } catch {}\r\n  }\r\n  return config;\r\n});\r\n\r\n// tự refresh token khi 401\r\napi.interceptors.response.use(\r\n  (res) => res,\r\n  async (error) => {\r\n    const original = error.config;\r\n\r\n    // nếu token hết hạn\r\n    if (error.response?.status === 401 && !original._retry) {\r\n      original._retry = true;\r\n\r\n      const saved = localStorage.getItem(\"authUser\");\r\n      if (!saved) return Promise.reject(error);\r\n\r\n      const { refreshToken } = JSON.parse(saved);\r\n\r\n      try {\r\n        const res = await axios.post(\"http://localhost:5000/api/auth/refresh\", {\r\n          refreshToken,\r\n        });\r\n\r\n        const pack = {\r\n          token: res.data.token,\r\n          refreshToken: res.data.refreshToken,\r\n          user: JSON.parse(saved).user,\r\n        };\r\n\r\n        localStorage.setItem(\"authUser\", JSON.stringify(pack));\r\n        api.defaults.headers.Authorization = `Bearer ${res.data.token}`;\r\n        original.headers.Authorization = `Bearer ${res.data.token}`;\r\n\r\n        return api(original);\r\n      } catch (err) {\r\n        localStorage.removeItem(\"authUser\");\r\n        window.location.href = \"/\";\r\n      }\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;\r\n"],"mappings":"AAAA;AACA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,GAAG,GAAGD,KAAK,CAACE,MAAM,CAAC;EACvBC,OAAO,EAAEC,OAAO,CAACC,GAAG,CAACC,kBAAkB,IAAI;AAC7C,CAAC,CAAC;;AAEF;AACAL,GAAG,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG,CAAEC,MAAM,IAAK;EACvC,MAAMC,CAAC,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;EAC1C,IAAIF,CAAC,EAAE;IACL,IAAI;MACF,MAAM;QAAEG;MAAM,CAAC,GAAGC,IAAI,CAACC,KAAK,CAACL,CAAC,CAAC;MAC/B,IAAIG,KAAK,EAAEJ,MAAM,CAACO,OAAO,CAACC,aAAa,GAAG,UAAUJ,KAAK,EAAE;IAC7D,CAAC,CAAC,MAAM,CAAC;EACX;EACA,OAAOJ,MAAM;AACf,CAAC,CAAC;;AAEF;AACAT,GAAG,CAACM,YAAY,CAACY,QAAQ,CAACV,GAAG,CAC1BW,GAAG,IAAKA,GAAG,EACZ,MAAOC,KAAK,IAAK;EAAA,IAAAC,eAAA;EACf,MAAMC,QAAQ,GAAGF,KAAK,CAACX,MAAM;;EAE7B;EACA,IAAI,EAAAY,eAAA,GAAAD,KAAK,CAACF,QAAQ,cAAAG,eAAA,uBAAdA,eAAA,CAAgBE,MAAM,MAAK,GAAG,IAAI,CAACD,QAAQ,CAACE,MAAM,EAAE;IACtDF,QAAQ,CAACE,MAAM,GAAG,IAAI;IAEtB,MAAMC,KAAK,GAAGd,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;IAC9C,IAAI,CAACa,KAAK,EAAE,OAAOC,OAAO,CAACC,MAAM,CAACP,KAAK,CAAC;IAExC,MAAM;MAAEQ;IAAa,CAAC,GAAGd,IAAI,CAACC,KAAK,CAACU,KAAK,CAAC;IAE1C,IAAI;MACF,MAAMN,GAAG,GAAG,MAAMpB,KAAK,CAAC8B,IAAI,CAAC,wCAAwC,EAAE;QACrED;MACF,CAAC,CAAC;MAEF,MAAME,IAAI,GAAG;QACXjB,KAAK,EAAEM,GAAG,CAACY,IAAI,CAAClB,KAAK;QACrBe,YAAY,EAAET,GAAG,CAACY,IAAI,CAACH,YAAY;QACnCI,IAAI,EAAElB,IAAI,CAACC,KAAK,CAACU,KAAK,CAAC,CAACO;MAC1B,CAAC;MAEDrB,YAAY,CAACsB,OAAO,CAAC,UAAU,EAAEnB,IAAI,CAACoB,SAAS,CAACJ,IAAI,CAAC,CAAC;MACtD9B,GAAG,CAACmC,QAAQ,CAACnB,OAAO,CAACC,aAAa,GAAG,UAAUE,GAAG,CAACY,IAAI,CAAClB,KAAK,EAAE;MAC/DS,QAAQ,CAACN,OAAO,CAACC,aAAa,GAAG,UAAUE,GAAG,CAACY,IAAI,CAAClB,KAAK,EAAE;MAE3D,OAAOb,GAAG,CAACsB,QAAQ,CAAC;IACtB,CAAC,CAAC,OAAOc,GAAG,EAAE;MACZzB,YAAY,CAAC0B,UAAU,CAAC,UAAU,CAAC;MACnCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAG;IAC5B;EACF;EAEA,OAAOd,OAAO,CAACC,MAAM,CAACP,KAAK,CAAC;AAC9B,CACF,CAAC;AAED,eAAepB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}